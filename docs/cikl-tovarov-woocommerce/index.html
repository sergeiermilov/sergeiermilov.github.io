<!doctype html>
<html lang="ru">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

	<link rel="apple-touch-icon" sizes="180x180" href="../../assets/icons/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="../../assets/icons/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="../../assets/icons/favicon-16x16.png">
	<link rel="manifest" href="../../assets/icons/site.webmanifest">
	<link rel="mask-icon" href="../../assets/icons/safari-pinned-tab.svg" color="#787878">
	<meta name="msapplication-TileColor" content="#ffffff">
	<meta name="theme-color" content="#ffffff">

  	<!-- Bootstrap CSS -->
  	<link rel="stylesheet" href="../../assets/css/bootstrap.min.css">
	<link rel="stylesheet" href="../../assets/css/prism.css">
	<link rel="stylesheet" href="../../assets/css/style.css">

    <title>Циклы для вывода товаров WooCommerce &#8212; SergeiErmilov</title>
  </head>
<body class="position-relative">
	<!-- Yandex.Metrika counter -->
	<script type="text/javascript">
		(function(m,e,t,r,i,k,a){
			m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
			m[i].l=1*new Date();
			for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
			k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
		})(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=104047655', 'ym');

		ym(104047655, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
	</script>
	<noscript><div><img src="https://mc.yandex.ru/watch/104047655" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
	<!-- /Yandex.Metrika counter -->   

<!-- navbar section -->
<section class="navbar-section">
	<nav class="navbar navbar-expand-lg navbar-light bg-white">
		<div class="container">
			<a class="navbar-brand d-flex gap-3 align-items-center" href="../../">
				<img src="../../assets/images/sergei-150.png" alt="" width="80" height="80" class="d-inline-block align-middle">
				<div class="logo-block"><span class="fw-bold">Фронтенд</span><br><span class="small-font">Сергей Ермилов</span></div>
			</a>
			<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarSupportedContent">
				<ul class="navbar-nav ms-0 ms-md-5 mb-2 mb-lg-0">

					<li class="nav-item">
						<a class="nav-link" title="GitHub" target="_blank" href="https://github.com/uzabila"><img src="../../assets/images/gh.svg" alt="GitHub" width="32" height="32" class="mx-3" style="margin-top:-5px"></a>
					</li>

					<li class="nav-item">
						<a class="nav-link" href="../../about/">Обо мне</a>
					</li>

					<li class="nav-item">
						<a class="nav-link" href="../../services/">Услуги</a>
					</li>

					<li class="nav-item">
						<a class="nav-link" href="../../portfolio/">Портфолио</a>
					</li>

					<li class="nav-item">
						<a class="nav-link" href="../../docs/">Доки</a>
					</li>

					<li class="nav-item">
						<a class="nav-link" href="../../terms/">Термины</a>
					</li>

					<li class="nav-item">
						<a class="nav-link" href="../../tools/">Инструменты</a>
					</li>
					
					<li class="nav-item">
						<a class="nav-link" href="../../book/">Книга</a>
					</li>
		
					<li class="nav-item">
						<a class="nav-link" href="../../contacts/">Контакты</a>
					</li>
			</div>
		</div>
	</nav>
</section>
<!-- ---------- --> 
<!-- END HEADER -->
<!-- ---------- -->

<div class="container">
	<div class="row mb-3 mb-md-4 mb-lg-5">
		<div class="col-12 single-content-column">
			<p><a href="../" class="link-secondary">Доки</a></p>
			<h1 class="fw-600">Циклы для вывода товаров WooCommerce</h1>

<p>WooCommerce — это самое быстрорастущее решение для электронной коммерции в Интернете для системы управления сайтом WordPress.</p>

<p>Существуют тысячи тем WooCommerce, которые помогут вам создать свой магазин, но что, если вы хотите настроить уникальное отображение товаров на сайтах ваших клиентов. Понимание того, как WooCommerce отображает товары на разных страницах — первый шаг к уникализации темы для ваших заказчиков.</p>

<h2>Цикл для отображения товаров WooCommerce</h2>

<p>Когда на странице магазина WooCommerce отображается список товаров, код, который выводит список товаров, называется «Циклом товаров». Терминология напоминает цикл записей в блоге WordPress, где список записей выводится на страницах блога и архива. Принцип работы тот же.</p>

<p>Концепция кода довольно проста даже для понимания теми, кто почти не имеет опыта разработки. Цикл проверяет, не осталось ли еще товаров (при определенных условиях) для отображения.</p>

<p>Если они есть, детали продукта берутся из базы данных, выводятся на экран, а затем процесс перезапускается или зацикливается до тех пор, пока не останется ни одного продукта для отображения по заданным условиям.</p>

<h2>Важность цикла товаров</h2>

<p>Бывают обстоятельства, когда вам нужно отобразить список определенных товаров на странице, что невозможно сделать с помощью обычных шорткодов, которые идут вместе с самим плагином.</p>

<p>В этом случае вам, скорее всего, потребуется вставить код пользовательского цикла товаров в шаблон страницы магазина. Каждая тема WooCommerce и плагин поиска и фильтрации используют пользовательские циклы для отображения результатов поиска товаров.</p>

<h2>Где найти цикл товаров WooCommerce?</h2>

<p>Цикл товаров WooCommerce эволюционировал за последние четыре-пять лет, с тех пор как Automatic приобрела WooCommerce. Ушел в прошлое один небольшой кусок кода, выводивший комбинацию PHP вперемешку с HTML.</p>

<p>Теперь цикл товаров WooCommerce — это усовершенствованный, подключаемый модуль. Лучше всего найти дефолтный цикл товаров WooCommerce в файле шаблона: <strong>/template/archive-product.php</strong>.</p>

<p>Папка <strong>/template/</strong> в плагине WooCommere содержит шаблоны, которые вы можете скопировать в свою дочернюю тему, чтобы настроить определенные страницы WooCommerce.</p>

<p>Также вы можете просмотреть файл <strong>archive-product.php</strong> по адресу:</p>

<pre><code class="language-bash">https://github.com/woocommerce/woocommerce/blob/6.5.0/plugins/woocommerce/templates/archive-product.php</code></pre>

<h2>Код цикла товаров WooCommerce</h2>

<p>Я удалил многие комментарии из исходного кода, чтобы показать простоту текущего цикла.</p>

<pre><code class="language-php">if ( woocommerce_product_loop() ) {
	do_action( 'woocommerce_before_shop_loop' );
	woocommerce_product_loop_start();
	if ( wc_get_loop_prop( 'total' ) ) {
		while ( have_posts() ) {
			the_post();
			do_action( 'woocommerce_shop_loop' );
			wc_get_template_part( 'content', 'product' );
		}
	}
	woocommerce_product_loop_end();
	do_action( 'woocommerce_after_shop_loop' );
} else {
	do_action( 'woocommerce_no_products_found' );
}</code>
</pre>

<p>Я объясню, что происходит в коде на верхнем уровне.</p>

<p>Сам цикл товаров окружен условным оператором <code>if</code>, строки <strong>1</strong>, <strong>13</strong> и <strong>15</strong>, который проверяет, является ли это циклом товаров WooCommerce; в противном случае он сообщает браузеру, что в строке <strong>14</strong> товаров не найдено.</p>

<p>Строки <strong>2</strong> и <strong>12</strong> позволяют подключить или запустить свои функции для вывода содержимого непосредственно до и после цикла товаров, используя имена хуков WordPress <code>woocommerce_before_shop_loop</code> и <code>woocommerce_after_shop_loop</code>.</p>

<p>Не волнуйтесь, если вы не знаете, как использовать хуки WordPress, просто знайте, что это возможно. Строки <strong>3</strong> и <strong>11</strong> запускают и завершают цикл товаров WooCommerce соответственно.</p>

<p>Функция <code>woocommerce_product_loop_start</code> устанавливает указатели и счетчики и подготавливает базу данных WordPress для запроса.</p>

<p>Функция <code>woocommerce_product_loop_end</code> закрывает соединение с базой данных, сбрасывает указатели и приводит все в порядок, готовясь к очередному запросу WordPress.</p>

<p>Строки <strong>4</strong> и <strong>10</strong> содержат условный оператор, проверяющий, сколько всего товаров находится в базе данных, и выполняющий код внутри оператора только в том случае, если общее количество товаров больше нуля.</p>

<p>Наконец, в строках с <strong>5</strong> по <strong>9</strong> запускается собственно цикл вывода товаров WooCommerce, в котором информация о товарах извлекается из базы данных и выводится в браузер.</p>

<p>Строка 8 вызывает другой шаблон, <strong>/templates/content-product.php</strong>, для вывода данных о товарах.</p>

<p>Вы можете посмотреть этот шаблон онлайн здесь:</p>

<pre><code class="language-bash">https://github.com/woocommerce/woocommerce/blob/6.5.0/plugins/woocommerce/templates/content-product.php</code></pre>

<h2>Альтернативный пользовательский цикл товаров WooCommerce</h2>

<p>Документация WooCommerce довольно хороша, и у них есть альтернативный пример кода для пользовательского цикла товаров WooCommerce:</p>

<pre><code class="language-php">&lt;ul class="products"&gt;
	&lt;?php
		$args = array(
			'post_type' =&gt; 'product',
			'posts_per_page' =&gt; 12
			);
		$loop = new WP_Query( $args );
		if ( $loop-&gt;have_posts() ) {
			while ( $loop-&gt;have_posts() ) : $loop-&gt;the_post();
				wc_get_template_part( 'content', 'product' );
			endwhile;
		} else {
			echo __( 'No products found' );
		}
		wp_reset_postdata();
	?&gt;
&lt;/ul&gt;</code></pre>

<p>Приведенный выше код очень похож на тот, который мы рассмотрели выше, но вместо того, чтобы использовать все эти функции WooCommerce для настройки, этот фрагмент кода использует объект <code>WP_Query</code> для настройки запроса к базе данных для получения данных о товаре.</p>

<p>Критерии поиска товаров задаются в массиве <code>$arg</code> в строках <strong>3-6</strong>.</p>

<p>В приведенном выше фрагменте кода запрос ищет записи типа <code>'product'</code>, а пагинация страниц настроена так, чтобы возвращать 12 товаров на страницу. Вы можете настроить условия запроса, добавив условия в переменную <code>$arg</code>.</p>

<p>Ознакомьтесь с документацией WP_Query по адресу:</p>

<pre><code class="language-bash">https://developer.wordpress.org/reference/classes/wp_query/</code></pre>

<h2>Пользовательский цикл для вывода продуктов</h2>

<p>Ниже приведу пользовательский цикл, в случае если вы хотите где-то вывести продукты WooCommerce у себя на сайте, например, на главной странице.</p>

<p>Мы можем использовать вполне стандартный цикл WordPress и получить доступ к продуктам через этот цикл, установив для аргумента <code>post_type</code> (тип записи) значение <code>product</code>:</p>

<pre><code class="language-php">&lt;?php

// Setup your custom query
$args = array( 'post_type' =&gt; 'product', ... );
$loop = new WP_Query( $args );

while ( $loop-&gt;have_posts() ) : $loop-&gt;the_post(); ?&gt;

    &lt;a href="&lt;?php echo get_permalink( $loop-&gt;post-&gt;ID ) ?&gt;"&gt;
        &lt;?php the_title(); ?&gt;
    &lt;/a&gt;

&lt;?php endwhile; wp_reset_query(); ?&gt;</code>
</pre>

<p>Не забываем использовать «сброс» цикла в конце через <code>wp_reset_query();</code>. Другой рекомендуемый вариант — использовать <code>wp_reset_postdata();</code>.</p>

<p>Если вы хотите получить цену и т.д., вы можете сделать так:</p>

<pre><code class="language-php">$product = get_product($loop-&gt;post);</code></pre>

<p>И затем использовать его так же, как используется <code>WC_Product</code>:</p>

<pre><code class="language-php">echo $product-&gt;get_price_html();</code></pre>

<p><strong>UPD</strong></p>

<p>Функция <code>get_product()</code> была упразднена, используйте вместо неё:</p>

<pre><code class="language-php">$product = new WC_Product($loop-&gt;post-&gt;ID);</code></pre>

<p>Если у вас есть вопросы — оставляйте комментарий, я обязательно постараюсь ответить.</p>

<h2>Заключение</h2>

<p>В цикле товаров WooCommerce есть много деталей, которые я исключил из этого материала, чтобы он получился более понятным для начинающих разработчиков.</p>

<p>Чтобы настроить цикл товаров WooCommerce, вам нужно будет понять, как использовать хуки и фильтры WordPress. Но подробнее об этом мы поговорим в следующих статьях.</p>
			
		</div>
	</div>
</div>
<div class="container">
	<div class="row">
		<div class="col-12 col-md-7">
			<div class="mb-3 mb-mb-4 d-flex gap-3">
				<div>
					<img alt="Сергей Ермилов" src="../../assets/images/sergei-450.png" height="68" width="68">
				</span>
				</div>
				<div>
					<a href="../../about/" class="link-dark link-offset-2 link-underline-opacity-25 link-underline-opacity-100-hover">Сергей Ермилов</a><br>
					<span>Дизайнер, верстальщик, фронтенд-разработчик, PHP и WordPress энтузиаст, главный редактор сайта</span>
				</div>
			</div> 
		</div>
		<div class="col-12 col-md-5">
			<span class="text-muted">Опубликовано 29 апреля 2024 в 23:57</span><br>Теги: PHP, WordPress, WooCommerce
		</div>
	</div>
</div>

<!-- ------------ -->
<!-- START FOOTER -->
<!-- ------------ -->
<footer class="py-5">
	<div class="container">
		<div class="row">
			<div class="col-12 col-md-4 my-auto">
				<span class="fw-500 text-muted">SergeiErmilov</span>
			</div>
			<div class="col-12 col-md-4 text-center my-auto">
				<img src="../../assets/images/sergei-150.png" alt="Sergei Ermilov" width="80" height="80">
			</div>
			<div class="col-12 col-md-4 my-auto text-end">
				<span class="fw-500 text-muted">&copy; 2008-<script>document.write(new Date().getFullYear())</script></span>
			</div>
		</div>
	</div>
</footer>

	<script src="../../assets/js/bootstrap.bundle.min.js"></script>
	<script src="../../assets/js/app.js"></script>
	<script src="../../assets/js/prism.js"></script>	

  </body>
</html>