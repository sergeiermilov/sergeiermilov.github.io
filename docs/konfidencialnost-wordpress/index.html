<!doctype html>
<html lang="ru">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

	<link rel="apple-touch-icon" sizes="180x180" href="../../assets/icons/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="../../assets/icons/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="../../assets/icons/favicon-16x16.png">
	<link rel="manifest" href="../../assets/icons/site.webmanifest">
	<link rel="mask-icon" href="../../assets/icons/safari-pinned-tab.svg" color="#787878">
	<meta name="msapplication-TileColor" content="#ffffff">
	<meta name="theme-color" content="#ffffff">

  	<!-- Bootstrap CSS -->
  	<link rel="stylesheet" href="../../assets/css/bootstrap.min.css">
	<link rel="stylesheet" href="../../assets/css/prism.css">
	<link rel="stylesheet" href="../../assets/css/style.css">

    <title>Конфиденциальность в WordPress &#8212; SergeiErmilov</title>
  </head>
<body class="position-relative">
	<!-- Yandex.Metrika counter -->
	<script type="text/javascript">
		(function(m,e,t,r,i,k,a){
			m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
			m[i].l=1*new Date();
			for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
			k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
		})(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=104047655', 'ym');

		ym(104047655, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
	</script>
	<noscript><div><img src="https://mc.yandex.ru/watch/104047655" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
	<!-- /Yandex.Metrika counter -->   

<!-- navbar section -->
<section class="navbar-section">
	<nav class="navbar navbar-expand-lg navbar-light bg-white">
		<div class="container">
			<a class="navbar-brand d-flex gap-3 align-items-center" href="../../">
				<img src="../../assets/images/sergei-150.png" alt="" width="80" height="80" class="d-inline-block align-middle">
				<div class="logo-block"><span class="fw-bold">Фронтенд</span><br><span class="small-font">Сергей Ермилов</span></div>
			</a>
			<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarSupportedContent">
				<ul class="navbar-nav ms-0 ms-md-5 mb-2 mb-lg-0">

					<li class="nav-item">
						<a class="nav-link" title="GitHub" target="_blank" href="https://github.com/uzabila"><img src="../../assets/images/gh.svg" alt="GitHub" width="32" height="32" class="mx-3" style="margin-top:-5px"></a>
					</li>

					<li class="nav-item">
						<a class="nav-link" href="../../about/">Обо мне</a>
					</li>

					<li class="nav-item">
						<a class="nav-link" href="../../services/">Услуги</a>
					</li>

					<li class="nav-item">
						<a class="nav-link" href="../../portfolio/">Портфолио</a>
					</li>

					<li class="nav-item">
						<a class="nav-link" href="../../docs/">Доки</a>
					</li>

					<li class="nav-item">
						<a class="nav-link" href="../../terms/">Термины</a>
					</li>

					<li class="nav-item">
						<a class="nav-link" href="../../tools/">Инструменты</a>
					</li>
					
					<li class="nav-item">
						<a class="nav-link" href="../../book/">Книга</a>
					</li>
		
					<li class="nav-item">
						<a class="nav-link" href="../../contacts/">Контакты</a>
					</li>
			</div>
		</div>
	</nav>
</section>
<!-- ---------- --> 
<!-- END HEADER -->
<!-- ---------- -->

<div class="container">
	<div class="row mb-3 mb-md-4 mb-lg-5">
		<div class="col-12 single-content-column">
			<p><a href="../" class="link-secondary">Доки</a></p>
			<h1 class="fw-600">Конфиденциальность в WordPress</h1>

<p>Сегодня поговорим про конфиденциальность в WordPress при создании тем и плагинов, что это и зачем нужно. Вы пишете плагин, который обрабатывает личные данные — такие вещи, как имена, адреса и другие вещи, которые могут быть использованы для идентификации личности? Вы захотите позаботиться об этих данных и защитить конфиденциальность ваших пользователей и посетителей.</p>

<h2><span id="Cto_takoe_Konfidencialnost">Что такое Конфиденциальность?</span></h2>



<p>Вы пишете плагин, который обрабатывает личные данные — такие вещи, как имена, адреса и другие вещи, которые могут быть использованы для идентификации личности? Вы захотите позаботиться об этих данных и защитить конфиденциальность ваших пользователей и посетителей.</p>



<p>WordPress.org сделал несколько усовершенствований, опередив европейское Общее Положение о Защите Данных (GDPR, General Data Protection Regulation).</p>



<p>После начала этой работы они сделали конфиденциальность постоянным фокусом в развитии основных направлений, что позволит им продолжать вносить усовершенствования в конфиденциальность в WordPress для тем и плагинов, и защиты данных вне рамок конкретного законодательства.</p>



<p>Но какие вопросы могут подпадать под определение «конфиденциальности», и как мы это определяем? </p>



<p>Несмотря на то, что требования к конфиденциальности сильно различаются в разных странах, культурах и правовых системах, существует несколько общих принципов, применимых в любой ситуации:</p>



<ul>
<li><strong>Согласие и выбор</strong>: предоставление пользователям (и посетителям сайта) выбора и вариантов использования их данных, а также требование ясного, конкретного и информированного согласия;</li>



<li><strong>Законность и спецификация</strong> цели: собирать и использовать персональные данные только в целях, для которых они предназначены, и для которых пользователь был заранее проинформирован;</li>



<li><strong>Ограничение по сбору</strong>: собирайте только те данные пользователя, которые необходимы; не делайте дополнительных копий данных и не комбинируйте свои данные с данными из других плагинов, если вы можете этого избежать.</li>



<li><strong>Минимизация данных</strong>: ограничить обработку данных, а также количество людей, имеющих к ним доступ, до минимума и людей, которые в ней нуждаются;</li>



<li><strong>Ограничение</strong> использования, хранения и раскрытия: удаляйте данные, которые больше не нужны, как при активном использовании, так и в архивах, как получателем, так и любыми третьими лицами;</li>



<li><strong>Точность и качество</strong>: убедитесь, что собранные и используемые данные являются правильными, релевантными и актуальными, особенно если неточные или недостоверные данные могут отрицательно повлиять на пользователя;</li>



<li><strong>Открытость, прозрачность и уведомление</strong>: информируйте пользователей о том, как их данные собираются, используются и передаются, а также о любых правах, которые они имеют в отношении такого использования;</li>



<li><strong>Индивидуальное участие и доступ</strong>: предоставить пользователям возможность доступа или скачивания своих данных;</li>



<li><strong>Подотчетность</strong>: документирование использования данных, защита их при передаче и использовании третьими лицами, а также предотвращение неправомерного использования и нарушений в максимально возможной степени;</li>



<li><strong>Информационная безопасность</strong>: защита данных путем принятия соответствующих технических мер и мер безопасности;</li>



<li><strong>Соблюдение конфиденциальности</strong>: обеспечение соответствия работы правилам конфиденциальности того места, где она будет использоваться для сбора и обработки данных людей.</li>
</ul>



<p>(Источник: <a rel="noreferrer noopener" href="https://www.iso.org/standard/45123.html" target="_blank">ISO 29100/Privacy Framework standard</a>)</p>



<p>Хотя не все из этих принципов будут применимы во всех ситуациях и областях применения, их использование в процессе разработки может помочь обеспечить доверие пользователей.</p>



<h2><span id="Konfidencialnost_v_dizajne">Конфиденциальность в дизайне</span></h2>



<p>Многие из этих принципов соблюдаются в рамках концепции «Конфиденциальность в дизайне», которая гласит следующее:</p>



<ul>
<li>Конфиденциальность в WordPress должна быть проактивной, а не реактивной, и должна предвосхищать вопросы конфиденциальности до того, как они дойдут до пользователя. Конфиденциальность также должна быть превентивной, а не корректирующей.</li>



<li>Конфиденциальность должна быть настройкой по умолчанию. Пользователь не должен предпринимать никаких действий для обеспечения своей конфиденциальности, и согласие на обмен данными не должно приниматься во внимание.</li>



<li>Конфиденциальность должна быть встроена в дизайн как основная функция, а не как дополнение.</li>



<li>Конфиденциальность должна быть положительной составляющей: не должно быть никаких компромиссов между конфиденциальностью и безопасностью, конфиденциальностью и надежностью, или конфиденциальностью и предоставлением услуг.</li>



<li>Конфиденциальность должна обеспечивать защиту в течение всего жизненного цикла за счет минимизации данных, минимального сохранения данных и регулярного удаления данных, в которых больше нет необходимости.</li>



<li>Стандарты конфиденциальности, используемые в Вашем плагине (и сервисе, если применимо) должны быть видимыми, прозрачными, открытыми, документированными и независимо проверяемыми.</li>



<li>Конфиденциальность должна быть ориентирована на пользователя. Людям должны быть предоставлены такие опции, как детальный выбор конфиденциальности, максимальная степень конфиденциальности по умолчанию, подробные уведомления о конфиденциальности, удобные для пользователя опции и четкое уведомление об изменениях.</li>
</ul>



<h2><span id="Osnovnye_voprosy_pro_konfidencialnost_v_WordPress">Основные вопросы про конфиденциальность в WordPress</span></h2>



<p>Чтобы помочь вашему плагину быть готовым, мы рекомендуем просмотреть следующий список вопросов для каждого плагина, который вы делаете:</p>



<p>1. Как Ваш плагин обрабатывает персональные данные? Используйте <code>wp_add_privacy_policy_content(ссылка)</code>, чтобы раскрыть вашим пользователям следующее:</p>



<ul>
<li>Предоставляет ли плагин личные данные третьим лицам (например, внешним API / серверам). Если да, какие данные он передает третьим сторонам и имеет ли они опубликованную политику конфиденциальности, на которую вы можете указать ссылку?</li>



<li>Собирает ли плагин личные данные? Если да, то какие данные и где они хранятся? Подумайте о таких местах, как пользовательские данные/мета, опции, почтовые мета-данные, пользовательские таблицы, файлы и т.д.</li>



<li>Использует ли плагин личные данные, собранные другими? Если да, то какие данные? Передает ли плагин персональные данные SDK? Что SDK делает с данными?</li>



<li>Плагин собирает данные телеметрии, прямо или косвенно? Например, загрузка изображения из стороннего источника при каждой установке может косвенно регистрировать и отслеживать данные об использовании всех установок вашего плагина.</li>



<li>Вызывает ли плагин Javascript, отслеживающие пиксели или встраиваемые iframe от третьей стороны (сторонние JS, отслеживающие пиксели и iframe могут собирать данные/действия посетителей, оставлять куки и т.д.)?</li>



<li>Хранит ли плагин что-то в браузере? Если да, то где и что? Подумайте о таких объектах, как файлы cookie, локальное хранилище и т.д.</li>
</ul>



<p>2. Если Ваш плагин собирает личные данные…</p>



<ul>
<li>Обеспечивает ли он экспорт персональных данных?</li>



<li>Предоставляет ли он обратный вызов для удаления личных данных?</li>



<li>По каким причинам (если таковые имеются) плагин отказывается удалять личные данные? (например, еще не выполненный заказ и т.д.) — эти данные также должны быть раскрыты.</li>
</ul>



<p>3. Использует ли плагин протоколирование ошибок? Это позволяет избежать регистрации личных данных, если это возможно? Можете ли вы использовать, например, <code>wp_privacy_anonymize_data</code>, чтобы минимизировать зарегистрированные личные данные? Как долго хранятся записи в журнале? Кто имеет к ним доступ?</p>



<p>4. В <strong>wp-admin</strong>, какая роль/возможности необходимы для доступа/просмотра персональных данных? Достаточны ли они?</p>



<p>5. Какие персональные данные отображаются на фронтенде сайта с помощью плагина? Появляются ли они для пользователей, вошедших и вышедших из системы? Должны ли?</p>



<p>6. Какие персональные данные раскрываются плагином в конечных точках <strong>REST API</strong>? Появляются ли они для зарегистрированных и вышедших из системы пользователей? Какие роли/возможности необходимы, чтобы их увидеть? Являются ли они подходящими?</p>



<p>7. Правильно ли плагин удаляет/очищает данные, включая, в частности, личные данные:</p>



<ul>
<li>Во время деинсталляции плагина?</li>



<li>Когда связанный элемент удаляется (например, из мета-данных записи или любых реферальных строк в другой таблице)?</li>



<li>Когда пользователь удаляется (например, из любой пользовательской строки в таблице)?</li>
</ul>



<p>8. Предоставляет ли плагин элементы управления для уменьшения количества необходимых личных данных?</p>



<p>9. Разделяет ли плагин личные данные с SDK или API только тогда, когда SDK или API требует этого, или плагин также обменивается личными данными, которые являются необязательными?</p>



<p>10. Меняется ли количество личных данных, собираемых или передаваемых этим плагином, при установке некоторых других плагинов?</p>



<p>Эти вопросы про конфиденциальность в WordPress создатели CMS считают обязательными для владельцев сайтов и разработчиков.</p>



<p>Внешние ресурсы:</p>



<ul>
<li>Блог конфиденциальности — <a href="https://privacy.blog/" target="_blank" rel="noreferrer noopener nofollow">https://privacy.blog</a></li>



<li>Политика конфиденциальности WordPress.org <a href="https://wordpress.org/about/privacy/" target="_blank" rel="noreferrer noopener">https://wordpress.org/about/privacy/</a></li>
</ul>



<h2><span id="Soderzanie_Politiki_Konfidencialnosti">Содержание Политики Конфиденциальности</span></h2>



<p><strong>Предлагаемый текст для политики конфиденциальности сайта</strong></p>



<p>Каждый модуль, который собирает, использует или хранит пользовательские данные, или передает их внешнему источнику или третьей стороне, должен добавлять раздел предлагаемого текста в почтовый ящик политики конфиденциальности.</p>



<p>Это лучше всего делать с помощью <code>wp_add_privacy_policy_content( $plugin_name, $policy_text )</code>. Это позволит администраторам сайта включить эту информацию в политику конфиденциальности своего сайта.</p>



<p>Чтобы сделать это проще для пользователей, текст должен отвечать на вопросы, предусмотренные политикой конфиденциальности по умолчанию:</p>



<ul>
<li>Какие личные данные мы собираем и почему мы их собираем<br>
— Самостоятельно вводить информацию вручную<br>
— WP: Контактные формы<br>
— WP: Комментарии<br>
— WP: Куки-файлы<br>
— WP: Встраивания третьей стороны<br>
— Аналитика</li>



<li>С кем мы делимся вашими данными</li>



<li>Как долго мы храним ваши данные</li>



<li>Какие у вас есть права на ваши данные</li>



<li>Куда мы отправляем ваши данные</li>



<li>Ваши контактные данные</li>



<li>Как мы защищаем ваши данные</li>



<li>Какие процедуры по нарушению данных у нас есть</li>



<li>От каких третьих лиц мы получаем данные</li>



<li>Какие автоматические решения и/или профилирование мы делаем с данными пользователя</li>



<li>Любые требования по раскрытию информации, регулирующие отрасль</li>
</ul>



<p>Хотя не все из этих вопросов применимы ко всем плагинам, мы рекомендуем обратить внимание на разделы об обмене данными.</p>



<p><strong>Пример кода</strong></p>


<div class="attention-blue">Рекомендуется вызывать <code style="font-family: monospace; direction: ltr; unicode-bidi: embed; padding: 0px; margin: 0px; background: inherit; font-size: inherit;">wp_add_privacy_policy_content</code> во время действия (экшена) <strong style="font-weight: 600;">admin_init</strong>. Вызов его вне хука действия может привести к проблемам, подробности см. в тикете #44142.</div>


<div class="attention-blue">Дополнительная информация может быть предоставлена с помощью специального CSS-класса <code style="font-family: monospace; direction: ltr; unicode-bidi: embed; padding: 0px; margin: 0px; background: inherit; font-size: inherit;">.privacy-policy-tutorial</code>. Любое содержимое, содержащееся в элементах HTML, к которым применен этот класс CSS, будет исключено из буфера обмена при копировании содержимого раздела.</div>



<pre><code class="language-php">function my_example_plugin_add_privacy_policy_content() {
    if ( ! function_exists( 'wp_add_privacy_policy_content' ) ) {
        return;
    }
    $content = '&lt;p class="privacy-policy-tutorial"&gt;' . __( 'Some introductory content for the suggested text.', 'my_plugin_textdomain' ) . '&lt;/p&gt;'
             . '&lt;strong class="privacy-policy-tutorial"&gt;' . __( 'Suggested Text:', 'my_plugin_textdomain' ) . '&lt;/strong&gt; '
             . sprintf(
                    __( 'When you leave a comment on this site, we send your name, email address, IP address and comment text to example.com. Example.com does not retain your personal data. The example.com privacy policy is &lt;a href="%s" target="_blank"&gt;here&lt;/a&gt;.', 'my_plugin_textdomain' ),
                  'https://example.com/privacy-policy'
                );
    wp_add_privacy_policy_content( 'Example Plugin', wp_kses_post( wpautop( $content, false ) ) );
}
 
add_action( 'admin_init', 'my_example_plugin_add_privacy_policy_content' );</code></pre>



<h2><span id="Dobavlenie_Eksportera_Licnyh_Dannyh">Добавление Экспортера Личных Данных</span></h2>



<p>В WordPress 4.9.6 были добавлены новые инструменты, облегчающие соблюдение таких законов, как Общее Положение Европейского Союза о Защите Данных, или сокращенно GDPR.</p>



<p>Среди инструментов, добавленных в WordPress 4.9.6, появился инструмент Экспорт Персональных Данных (Personal Data Export), который поддерживает экспорт всех персональных данных для данного пользователя в ZIP-файл.</p>



<p>В дополнение к персональным данным, хранящимся в таких объектах, как комментарии WordPress, плагины могут также подключаться к функции экспортера, чтобы экспортировать персональные данные, которые они собирают, будь то в нечто вроде postmeta или даже в совершенно новый Пользовательский Тип Данных (Custom Post Type, CPT).</p>



<p>«Ключом» для всех экспортируемых данных является адрес электронной почты пользователя — он был выбран потому, что поддерживает экспорт персональных данных как для полноправных зарегистрированных пользователей, так и для незарегистрированных (например, как комментатор, вышедший из системы).</p>



<p>Однако, поскольку сборка экспорта персональных данных может быть интенсивным процессом и, вероятно, будет содержать конфиденциальные данные, мы не хотим просто генерировать их и отправлять по электронной почте запрашивающей стороне без подтверждения запроса, поэтому пользовательский интерфейс, с которым сталкивается администратор, запускает все запросы.</p>



<p>Администратор вводит имя пользователя или адрес электронной почты, который делает запрос, а затем отправляет ссылку для подтверждения своего запроса.</p>



<p>После подтверждения запроса администратор может сгенерировать и скачать или отправить непосредственно по электронной почте ZIP-файл экспорта личных данных для пользователя, или сделать экспорт в любом случае, если возникает необходимость. Внутри ZIP-файла, который получает пользователь, он найдет «мини-сайт» с индексной HTML-страницей, содержащей его персональные данные, организованные в группы (например, группа для комментариев и т.д.).</p>



<p>Независимо от того, загружает ли администратор ZIP-файл экспорта персональных данных или отправляет его непосредственно запрашивающему лицу, способ сборки экспорта персональных данных идентичен — и полагается на перехват «экспортера» обратных вызовов для выполнения грязной работы по сбору всех данных для экспорта.</p>



<p>Когда администратор нажимает на ссылку загрузки или электронной почты, начинается цикл AJAX, который повторяется над всеми экспортерами, зарегистрированными в системе, по одному. В дополнение к экспортерам, встроенным в ядро, плагины могут регистрировать свои собственные обратные вызовы экспортеров.</p>



<p>Интерфейс обратного вызова экспортера разработан таким образом, чтобы быть как можно более простым. Обратный вызов экспортера получает адрес электронной почты, с которым мы работаем, а также параметр страницы. Параметр страницы (который начинается с 1) используется для того, чтобы избежать подключаемых модулей, которые могут вызвать таймауты при попытке экспортировать все личные данные, которые они собрали за один раз. Хорошо себя зарекомендовавший плагин ограничит количество данных, которые он пытается стереть на одной странице (например, 100 сообщений, 200 комментариев и т.д.).</p>



<p>Обратный вызов экспортера отвечает всеми данными, которые у него есть для этого адреса электронной почты и страницы, и независимо от того, сделано это или нет. Если обратный вызов экспортера сообщит о том, что это не было сделано, то он будет вызван снова (в отдельном запросе) с параметром страницы, увеличенным на 1. Ожидается, что обратный вызов экспортера вернет массив элементов для экспорта. Каждый элемент содержит идентификатор группы, для группы которой элемент является частью (например, комментарии, записи, заказы и т.д.), необязательной групповой меткой (translated), идентификатором элемента (например, comment-133), а затем массивом имен, пар значений, содержащим данные, которые должны быть экспортированы для этого элемента.</p>



<p>Примечательно, что значением может быть путь к медиафайлу, в этом случае ссылка на медиафайл будет добавлена в индексную HTML-страницу при экспорте.</p>



<p>Когда все экспортеры были вызваны для завершения, WordPress сначала собирает HTML-документ «index», который служит сердцем экспортного отчета. Если плагин сообщает дополнительные данные для элемента, который WordPress или другой плагин уже добавил, то все данные для этого элемента будут представлены вместе.</p>



<p>Экспорт кэшируется на сервере в течение 3 дней, а затем удаляется.</p>



<p>Плагин может зарегистрировать одного или нескольких экспортеров, но большинству плагинов понадобится только один. Поработаем над гипотетическим плагином, который добавляет данные о местоположении комментатора к комментариям.</p>



<p>Во-первых, предположим, что плагин использовал <code>add_comment_meta</code> для добавления данных о местоположении, используя <code>meta_key</code> из <code>latitude</code> (широты) и <code>longitude</code> (долготы).</p>



<p>Первое, что нужно сделать плагину, это создать функцию экспортера, которая будет принимать адрес электронной почты и страницу, например:</p>



<pre><code class="language-php">function my_plugin_exporter( $email_address, $page = 1 ) {
  $number = 500; // Limit us to avoid timing out
  $page = (int) $page;
 
  $export_items = array();
 
  $comments = get_comments(
    array(
      'author_email' =&gt; $email_address,
      'number' =&gt; $number,
      'paged' =&gt; $page,
      'order_by' =&gt; 'comment_ID',
      'order' =&gt; 'ASC',
    )
  );
 
  foreach ( (array) $comments as $comment ) {
    $latitude = get_comment_meta( $comment-&gt;comment_ID, 'latitude', true );
    $longitude = get_comment_meta( $comment-&gt;comment_ID, 'longitude', true );
 
    // Only add location data to the export if it is not empty
    if ( ! empty( $latitude ) ) {
      // Most item IDs should look like postType-postID
      // If you don't have a post, comment or other ID to work with,
      // use a unique value to avoid having this item's export
      // combined in the final report with other items of the same id
      $item_id = "comment-{$comment-&gt;comment_ID}";
 
      // Core group IDs include 'comments', 'posts', etc.
      // But you can add your own group IDs as needed
      $group_id = 'comments';
 
      // Optional group label. Core provides these for core groups.
      // If you define your own group, the first exporter to
      // include a label will be used as the group label in the
      // final exported report
      $group_label = __( 'Comments' );
 
      // Plugins can add as many items in the item data array as they want
      $data = array(
        array(
          'name' =&gt; __( 'Commenter Latitude' ),
          'value' =&gt; $latitude
        ),
        array(
          'name' =&gt; __( 'Commenter Longitude' ),
          'value' =&gt; $longitude
        )
      );
 
      $export_items[] = array(
        'group_id' =&gt; $group_id,
        'group_label' =&gt; $group_label,
        'item_id' =&gt; $item_id,
        'data' =&gt; $data,
      );
    }
  }
 
  // Tell core if we have more comments to work on still
  $done = count( $comments ) &lt; $number;
  return array(
    'data' =&gt; $export_items,
    'done' =&gt; $done,
  );
}</code></pre>



<p>Следующее, что должен сделать плагин, это зарегистрировать обратный вызов, фильтруя массив экспортеров с помощью фильтра <code>wp_privacy_personal_data_exporters</code>.</p>



<p>При регистрации вы указываете дружественное имя для экспорта (для помощи в отладке — это дружественное имя в данный момент никому не показывается) и обратного вызова, например.</p>



<pre><code class="language-php">function register_my_plugin_exporter( $exporters ) {
  $exporters['my-plugin-slug'] = array(
    'exporter_friendly_name' =&gt; __( 'Comment Location Plugin' ),
    'callback' =&gt; 'my_plugin_exporter',
  );
  return $exporters;
}
 
add_filter(
  'wp_privacy_personal_data_exporters',
  'register_my_plugin_exporter',
  10
);</code></pre>



<p>И это все! Теперь ваш плагин будет предоставлять данные для экспорта!</p>



<h2><span id="Dobavlenie_Stiratela_licnyh_dannyh_k_vasemu_plaginu">Добавление Стирателя личных данных к вашему плагину</span></h2>



<p>В WordPress 4.9.6 были добавлены новые инструменты, облегчающие соблюдение таких законов, как Общее Положение Европейского Союза о Защите Данных, или сокращенно GDPR.</p>



<p>Среди инструментов, добавленных в WordPress 4.9.6, появился инструмент удаления личных данных (Personal Data Removal&nbsp;или Personal Data Eraser), который поддерживает удаление/анонимизацию личных данных для конкретного пользователя.</p>



<p>Он НЕ удаляет зарегистрированные учетные записи пользователей — это все еще отдельный шаг, который администратор может выбрать, делать это или нет.</p>



<p>В дополнение к личным данным, хранящимся в таких объектах, как комментарии WordPress, плагины могут также подключаться к стирателю, чтобы стереть личные данные, которые они собирают, будь то postmeta или даже в совершенно новых Пользовательских типах записей (Custom Post Type, CPT).</p>



<p>Как и в случае с экспортерами, «ключом» для всех ластиков является адрес электронной почты пользователя — он был выбран потому, что поддерживает стирание личных данных как для полноценных зарегистрированных пользователей, так и для незарегистрированных (например, как для комментатора, вышедшего из системы).</p>



<p>Однако, поскольку выполнение стирания личных данных является разрушительным процессом, мы не хотим просто сделать это без подтверждения запроса, поэтому пользовательский интерфейс, обращенный к администратору, начинает все запросы с того, что администратор вводит имя пользователя или адрес электронной почты, делая запрос, а затем посылает ссылку, нажав на которую, пользователь может подтвердить свой запрос. Как только запрос был подтвержден, администратор может начать стирание личных данных для пользователя, или заставить его, если необходимость возникает.</p>



<p>Способ стирания экспортируемых персональных данных аналогичен способу <strong>экспортеров персональных данных</strong> — и полагается на перехват «стирающих» обратных вызовов для выполнения грязной работы по стиранию данных. Когда администратор нажимает на ссылку удаления персональных данных, начинается цикл AJAX, который итературизирует все стиратели, зарегистрированные в системе, по очереди. В дополнение к стирателям, встроенным в ядро, плагины могут регистрировать свои собственные обратные вызовы стирателей.</p>



<p>Интерфейс обратного вызова стирателя разработан таким образом, чтобы быть как можно более простым. Обратный вызов стирателя получает адрес электронной почты, с которым мы работаем, а также параметр страницы. Параметр страницы (который начинается с 1) используется для того, чтобы избежать использования плагинов, которые могут вызывать таймауты, пытаясь стереть все личные данные, которые они собрали за один раз. Хорошо себя зарекомендовавший плагин ограничит количество данных, которые он пытается стереть на одной странице (например, 100 сообщений, 200 комментариев и т.д.).</p>



<p>Обратный вызов стирателя отвечает, были ли удалены элементы, содержащие личные данные, были ли сохранены какие-либо элементы, содержащие личные данные, массив сообщений для представления администратору (объясняя, почему элементы, которые были сохранены, были сохранены), и было ли это сделано или нет. Если обратный вызов стирателя сообщает, что это не было сделано, он будет вызван снова (в отдельном запросе) с параметром страницы, увеличенным на 1.</p>



<p>Когда все экспортеры были вызваны для завершения, пользовательский интерфейс администратора обновляется, чтобы показать, были ли стерты все найденные персональные данные, а также любые сообщения, объясняющие, почему персональные данные были сохранены.</p>



<p>Поработаем над гипотетическим плагином, который добавляет к комментариям данные о местоположении комментатора. Предположим, что плагин использовал <code>add_comment_meta</code> для добавления данных о местоположении, используя <code>meta_key</code>s из <code>latitude</code> (широта) и <code>longitude</code> (долгота).</p>



<p>Первое, что нужно сделать плагину, это создать функцию стирателя, которая будет принимать адрес электронной почты и страницу, например:</p>



<pre><code class="language-php">function my_plugin_eraser( $email_address, $page = 1 ) {
  $number = 500; // Limit us to avoid timing out
  $page = (int) $page;
 
  $comments = get_comments(
    array(
      'author_email' =&gt; $email_address,
      'number'       =&gt; $number,
      'paged'        =&gt; $page,
      'order_by'     =&gt; 'comment_ID',
      'order'        =&gt; 'ASC',
      )
  );
 
  $items_removed = false;
 
  foreach ( (array) $comments as $comment ) {
    $latitude  = get_comment_meta( $comment-&gt;comment_ID, 'latitude', true );
    $longitude = get_comment_meta( $comment-&gt;comment_ID, 'longitude', true );
 
    if ( ! empty( $latitude ) ) {
      delete_comment_meta( $comment-&gt;comment_ID, 'latitude' );
      $items_removed = true;
    }
 
    if ( ! empty( $longitude ) ) {
      delete_comment_meta( $comment-&gt;comment_ID, 'longitude' );
            $items_removed = true;
    }
  }
 
  // Tell core if we have more comments to work on still
  $done = count( $comments ) &lt; $number; return array( 'items_removed' =&gt; $items_removed,
    'items_retained' =&gt; false, // always false in this example
    'messages' =&gt; array(), // no messages in this example
    'done' =&gt; $done,
  );
}</code></pre>



<p>Следующее, что должен сделать плагин, это зарегистрировать обратный вызов, отфильтровав массив стирателей с помощью фильтра <code>wp_privacy_personal_data_erasers</code>.</p>



<p>При регистрации вы предоставляете дружественное имя для стирателя (для помощи в отладке — это дружественное имя в данный момент никому не показывается) и обратного вызова, например:</p>



<pre><code class="language-php">function register_my_plugin_eraser( $erasers ) {
  $erasers['my-plugin-slug'] = array(
    'eraser_friendly_name' =&gt; __( 'Comment Location Plugin' ),
    'callback'             =&gt; 'my_plugin_eraser',
    );
  return $erasers;
}
 
add_filter(
  'wp_privacy_personal_data_erasers',
  'register_my_plugin_eraser',
  10
);</code></pre>



<p>И это все! Ваш плагин теперь очистит свои личные данные!</p>



<h2><span id="Opcii_svazannye_s_konfidencialnostu_Huki_i_Vozmoznosti">Опции, связанные с конфиденциальностью, Хуки и Возможности</span></h2>



<p>Инструменты, что обеспечивают конфиденциальность в WordPress были первоначально представлены в версии 4.9.6.</p>



<p>Эти инструменты предназначены для того, чтобы позволить (и поощрить) разработчикам использовать их в рамках программ <strong>Экспорта Персональных Данных</strong> (Privacy Exporter), <strong>Стирания Персональных Данных</strong> (Privacy Eraser) и Руководства по политике конфиденциальности.</p>



<p>С тех пор было введено несколько новых хуков для расширения имеющихся возможностей. Эти хуки позволяют разработчикам включать дополнительные персональные данные в запросы на экспорт и стирание, а также знакомить с предлагаемым контентом для руководства по политике конфиденциальности.</p>



<p>Наряду с возможностью управления этими инструментами, появилось несколько новых фильтров для использования с запросами и подтверждениями электронной почты, что позволяет осуществлять более детальный контроль над этими уведомлениями.</p>



<h3><span id="Opcii">Опции</span></h3>



<p><code>wp_page_for_privacy_policy</code> — содержит ID страницы конфиденциальности сайта</p>



<h3><span id="Dejstvia_Ekseny">Действия (Экшены)</span></h3>



<p><code>user_request_action_confirmed</code> — срабатывает, когда пользователь подтверждает запрос конфиденциальности</p>



<p><code>wp_privacy_delete_old_export_files</code> — запланированное действие, используемое для удаления старого экспорта из папки экспорта личных данных</p>



<p><code>wp_privacy_personal_data_erased</code> — срабатывает после завершения последней страницы последнего стирателя</p>



<p><code>wp_privacy_personal_data_export_file</code> — используется для создания файла экспорта личных данных в рамках процесса экспорта</p>



<p><code>wp_privacy_personal_data_export_file_created</code> — срабатывает после создания файла экспорта персональных данных</p>



<h3><span id="Filtry">Фильтры</span></h3>



<p><code>privacy_policy_url</code> — фильтрует URL страницы политики конфиденциальности</p>



<p><code>the_privacy_policy_link</code> — фильтрует ссылку на страницу политики конфиденциальности HTML</p>



<p><code>wp_get_default_privacy_policy_content</code> — фильтрует контент по умолчанию, предлагаемый для включения в руководстве по политике конфиденциальности</p>



<p><code>user_request_action_confirmed_message</code> — позволяет изменять отображаемое пользователю сообщение с подтверждением действия</p>



<p><code>user_request_action_description</code> — фильтрует описание действий пользователя</p>



<p><code>user_request_action_email_content</code> — фильтрует текст сообщения электронной почты, отправленного при попытке действия учетной записи</p>



<p><code>user_request_action_email_headers</code> — фильтрует заголовки письма, отправляемого при попытке действия учетной записи</p>



<p><code>user_request_action_email_subject</code> — фильтрует тему письма, отправляемого при попытке действия учетной записи</p>



<p><code>user_request_confirmed_email_content</code> — фильтрует тело письма с запросом подтверждения пользователя</p>



<p><code>user_request_confirmed_email_headers</code> — фильтрует заголовки письма подтверждения запроса пользователя</p>



<p><code>user_request_confirmed_email_subject</code> — фильтрует тему письма с запросом подтверждения пользователя</p>



<p><code>user_request_confirmed_email_to</code> — фильтрует получателя уведомления о подтверждении запроса данных</p>



<p><code>user_request_key_expiration</code> — фильтрует время истечения ключей подтверждения для пользовательских запросов</p>



<p><code>wp_privacy_additional_user_profile_data</code> — фильтр для расширения данных профиля пользователя для экспортера конфиденциальности</p>



<p><code>wp_privacy_export_expiration</code> — управляет разрешением получения старых файлов экспорта, по умолчанию — 3 дня</p>



<p><code>wp_privacy_personal_data_email_content</code> — позволяет изменить сообщение электронной почты, отправляемое пользователям с помощью ссылки на файл экспорта их личных данных</p>



<p><code>wp_privacy_personal_data_email_headers</code> — фильтрует заголовки письма, отправленного с файлом экспорта личных данных</p>



<p><code>wp_privacy_personal_data_email_subject</code> — фильтрует тему письма, отправленного после завершения запроса на экспорт</p>



<p><code>wp_privacy_personal_data_email_to</code> — фильтрует получателя уведомления по электронной почте экспорта личных данных</p>


<div class="attention-blue"><strong style="font-weight: 600;">wp_privacy_personal_data_email_to</strong> следует использовать с большой осторожностью, чтобы не отправлять ссылку на экспорт данных на неправильный адрес (а) электронной почты получателя.</div>



<p><code>wp_privacy_personal_data_erasers</code> — поддерживает регистрацию стирателей персональных данных ядра и плагина</p>



<p><code>wp_privacy_personal_data_erasure_page</code> — фильтрует страницу данных стирателя личных данных. Позволяет использовать ответ на стирание адресатами в дополнение к Ajax.</p>



<p><code>wp_privacy_personal_data_exporters</code> — поддерживает регистрацию экспортеров персональных данных ядра и плагинов</p>



<p><code>wp_privacy_personal_data_export_page</code> — фильтрует страницу данных экспортера персональных данных. Используется для создания отчета об экспорте. Позволяет использовать экспортный ответ для пунктов назначения в дополнение к Ajax.</p>



<p><code>wp_privacy_anonymize_data</code> — фильтрует анонимные данные для каждого типа</p>



<p><code>wp_privacy_exports_dir</code> — фильтрует каталог, в котором хранятся файлы экспорта личных данных</p>



<p><code>wp_privacy_exports_url</code> — фильтрует URL-адрес каталога, в котором хранятся файлы экспорта личных данных</p>



<p><code>user_confirmed_action_email_content</code> — фильтрует текст письма с подтверждением запроса пользователя. Электронное письмо отправляется администратору после подтверждения запроса пользователя.</p>



<p><code>user_erasure_fulfillment_email_to</code> — фильтрует получателя уведомления о выполнении стирания данных</p>



<p><code>user_erasure_complete_email_subject</code> — фильтрует тему сообщения электронной почты, отправленного после завершения запроса на удаление</p>



<p><code>user_confirmed_action_email_content</code> — фильтрует тело уведомления о выполнении стирания данных. Электронное письмо отправляется пользователю, когда администратор выполняет запрос на удаление данных.</p>



<p><code>user_erasure_complete_email_headers</code> — фильтрует заголовки уведомления о выполнении стирания данных</p>



<h3><span id="Vozmoznosti">Возможности</span></h3>



<p>Доступ к инструментам обеспечения конфиденциальности контролируется несколькими новыми возможностями.</p>



<p>По умолчанию эти возможности есть у администраторов (на немультисайтовых установках).</p>



<p>Этими возможностями являются:</p>



<p><code>erase_others_personal_data</code> — определяет, доступно ли подменю «Удалить личные данные» в разделе «Инструменты»</p>



<p><code>export_others_personal_data</code> — определяет, доступно ли подменю «Экспорт личных данных» в разделе «Инструменты»</p>



<p><code>manage_privacy_options</code> — определяет, доступно ли подменю Конфиденциальность в Настройках</p>



<p>На этом про конфиденциальность в WordPress всё. Я постараюсь дополнять данный материал по мере сил и возможностей.</p>
			
		</div>
	</div>
</div>
<div class="container">
	<div class="row">
		<div class="col-12 col-md-7">
			<div class="mb-3 mb-mb-4 d-flex gap-3">
				<div>
					<img alt="Сергей Ермилов" src="../../assets/images/sergei-450.png" height="68" width="68">
				</span>
				</div>
				<div>
					<a href="../../about/" class="link-dark link-offset-2 link-underline-opacity-25 link-underline-opacity-100-hover">Сергей Ермилов</a>

					<span>Дизайнер, верстальщик, фронтенд-разработчик, PHP и WordPress энтузиаст, главный редактор сайта</span>
				</div>
			</div> 
		</div>
		<div class="col-12 col-md-5">
			<span class="text-muted">Опубликовано 13 февраля 2023 в 14:09</span><br>Теги: WordPress
		</div>
	</div>
</div>

<!-- ------------ -->
<!-- START FOOTER -->
<!-- ------------ -->
<footer class="py-5">
	<div class="container">
		<div class="row">
			<div class="col-12 col-md-4 my-auto">
				<span class="fw-500 text-muted">SergeiErmilov</span>
			</div>
			<div class="col-12 col-md-4 text-center my-auto">
				<img src="../../assets/images/sergei-150.png" alt="Sergei Ermilov" width="80" height="80">
			</div>
			<div class="col-12 col-md-4 my-auto text-end">
				<span class="fw-500 text-muted">&copy; 2008-<script>document.write(new Date().getFullYear())</script></span>
			</div>
		</div>
	</div>
</footer>

	<script src="../../assets/js/bootstrap.bundle.min.js"></script>
	<script src="../../assets/js/app.js"></script>
	<script src="../../assets/js/prism.js"></script>	

  </body>
</html>